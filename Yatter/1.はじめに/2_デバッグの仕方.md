# Androidデバッグ
## はじめに
Androidアプリ開発に限らず、プログラム開発において問題特定と解決は非常に大きな要素です。
Android Studioには多くのデバッグ機能が搭載されており、アプリ開発に大いに役立ちます。
本ドキュメントでは、実務の開発現場でよく利用されるデバッグ技術を学びながら、デバッグ力を身につけることを目的としています。

# 扱う内容
1. Android Studioのデバッグ機能
1. Logcat
1. ログ出力
1. HTTPリクエストのログ確認
1. BreakPoint
1. Layout Inspector (Compose)


# Android Studioのデバッグ機能
Android Studioは、Androidアプリ開発のための統合開発環境（IDE）であり、強力なデバッグツール群を提供しています。これらのツールを活用することで、コードの実行をステップごとに追跡したり、変数の値を確認したり、実行時のエラーを特定したりすることが容易になります。代表的な機能には、Logcat、ブレークポイント、Layout Inspectorなどがあります。これらの機能を使いこなすことで、開発効率を大幅に向上させることができます。

# Logcat
Logcatは、Androidシステムや実行中のアプリから出力されるログメッセージを表示するウィンドウです。アプリの動作状況、エラーメッセージ、警告、開発者が出力したカスタムログなどをリアルタイムで確認できます。
LogcatウィンドウはAndroid Studioの下部に表示され、フィルタリング機能を使って特定のタグやログレベル（Verbose, Debug, Info, Warn, Error, Assert）を持つメッセージのみを表示させることが可能です。問題発生時の原因究明や、特定の処理が期待通りに実行されているかの確認に不可欠なツールです。

# ログ出力
開発中に特定の変数の値や処理の通過点を確認したい場合、`Log`クラスを使用してLogcatにメッセージを出力することができます。Kotlinでの基本的な使い方は以下の通りです。

```kotlin
import android.util.Log

// ...

// 例: デバッグログを出力
Log.d("Yatter", "Current value of counter: $counter")

// 例: 情報ログを出力
Log.i("Yatter", "User successfully logged in.")

// 例: エラーログを出力
Log.e("Yatter", "Error occurred during data fetch", exception)
```

`Log`クラスには複数のログレベルに対応するメソッドがあります。
*   `Log.v()` (Verbose): 最も詳細なログ。開発中の詳細なトレースに使用。
*   `Log.d()` (Debug): デバッグ時に有用な情報。開発中に一時的に使用し、リリース時には削除または無効化することが多い。
*   `Log.i()` (Info): アプリの通常の動作を示す情報。重要な処理の開始/終了など。
*   `Log.w()` (Warn): 予期しない問題や、将来問題になる可能性のある状況を示す警告。
*   `Log.e()` (Error): 実行中に発生したエラー。クラッシュには至らないが、機能が正しく動作しない場合など。
*   `Log.wtf()` (What a Terrible Failure / Assert): 発生してはならない致命的なエラー。

第一引数にはログを識別するためのタグ（通常はクラス名や機能名、定数などで定義すると管理しやすい）、第二引数に出力したいメッセージを指定します。これにより、Logcatで特定のタグやログレベルをフィルタリングして、関連するログだけを効率的に追跡できます。開発段階では `Log.d` を多用し、重要な処理の流れには `Log.i` を使うなど、目的に応じて使い分けることが推奨されます。

# HTTPリクエストのログ確認
ネットワーク通信を行うアプリでは、HTTPリクエストとレスポンスの内容を確認することがデバッグにおいて重要になります。特にAndroid開発では、ネットワークライブラリとしてRetrofitとOkHttpの組み合わせが広く使われています。
多くのプロジェクトでは、開発ビルド時にOkHttpの `HttpLoggingInterceptor` が設定されており、通信内容が自動的にLogcatに出力されるようになっている場合があります。

`HttpLoggingInterceptor` を利用することで、リクエスト/レスポンスのヘッダ、ボディ、ステータスコードなどの詳細な情報をLogcatに出力できます。

```kotlin
import okhttp3.OkHttpClient
import okhttp3.logging.HttpLoggingInterceptor

// ...

// ログレベルを設定 (BODYならヘッダとボディ両方、HEADERSならヘッダのみ等)
val logging = HttpLoggingInterceptor().apply {
    level = HttpLoggingInterceptor.Level.BODY
}

val client = OkHttpClient.Builder()
    .addInterceptor(logging) // インターセプターを追加
    .build()

// RetrofitなどでこのOkHttpClientインスタンスを使用する
```

**Logcatでの確認方法:**
`HttpLoggingInterceptor` が出力するログには、通常 `OkHttp` というタグが付与されます。Logcatウィンドウ上部のフィルター入力欄に `OkHttp` と入力するか、あるいはリクエスト先のURLの一部や特定のキーワード（例: `--> GET`, `<-- 200 OK`）でフィルタリングすることで、通信ログを簡単に見つけることができます。
出力レベルが `BODY` に設定されている場合、リクエストとレスポンスの内容がそのまま表示されるため、APIとの送受信データが正しいか、エラーレスポンスの内容は何か、などを直接確認でき、問題解決に役立ちます。
ただし、本番環境（リリースビルド）では、ログレベルを `NONE` にするかインターセプター自体を除外するなどして、機密情報（トークンや個人情報など）がログに出力されないように構成することが非常に重要です。

# BreakPoint
ブレークポイントは、コードの特定の行でプログラムの実行を一時停止させるためのマーカーです。デバッグモード（Run > Debug 'app'）でアプリを実行すると、実行がブレークポイントに到達した時点で停止します。

Android Studioでは、コードエディタの左側のガター（行番号の横）をクリックするだけで簡単にブレークポイントを設定・解除できます。

**停止時の値の確認方法:**
実行がブレークポイントで停止すると、Android Studioの下部に**Debugウィンドウ**が表示されます。
*   **Threads & Variablesペイン:** 現在のスコープにある変数とその値の一覧が表示されます。オブジェクトを展開して、そのプロパティやフィールドの詳細を確認することも可能です。変数の値は実行が進むにつれて変化するため、ステップ実行と組み合わせることで値の変化を追跡できます。

実行が停止した状態から、ステップ実行（ステップオーバー, ステップイン, ステップアウト）を使ってコードを一行ずつ進めたり、特定の処理をスキップしたりすることが可能です。これにより、コードの実行フローや条件分岐、変数値の変化を詳細に追いかけることができ、バグの原因特定に非常に有効です。

# Layout Inspector
Layout Inspectorは、実行中のアプリのUI階層を視覚的に確認・分析するためのツールです。Jetpack Composeで構築されたUIに対しても利用でき、コンポーザブル関数がどのように組み合わされ、どのようなパラメータ（修飾子、値）で描画されているかをリアルタイムで確認できます。

Android Studioのメニューから `Tools > Layout Inspector` を選択して起動します。接続されているデバイスまたはエミュレータで実行中のアプリのプロセスを選択すると、Layout Inspectorウィンドウが開きます。

Layout Inspectorを使うことで、「なぜこの余白が空いているのか」「このテキストの色は何によって決まっているのか」「どのModifierが適用されているのか」といった疑問を解決し、Compose UIのデバッグや最適化を効率的に進めることができます。
